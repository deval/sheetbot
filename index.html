<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Chatbot</h2>
        <div id="chatbox" class="border rounded p-3 mb-3" style="height: 400px; overflow-y: auto;"></div>
        <div class="input-group">
            <input type="text" id="userInput" class="form-control" placeholder="Type your question here...">
            <button id="sendButton" class="btn btn-primary">Send</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
    
    <script>
        const sheetID = 'https://docs.google.com/spreadsheets/d/1CKub3eujxi0wWRLfjRM6TG4h0BZVaFFQ5zM-3Dla624/pub?output=csv'; // Replace with your Google Sheet ID
        let qaDataset = [];

        function loadData() {
            Papa.parse(sheetID, {
                download: true,
                header: true,
                complete: function(results) {
                    qaDataset = results.data;
                    console.log('CSV data loaded:', qaDataset);
                },
                error: function(error) {
                    console.error('Error loading CSV dataset:', error);
                }
            });
        }

        function jaccardSimilarity(a, b) {
            const setA = new Set(a.toLowerCase().split(" "));
            const setB = new Set(b.toLowerCase().split(" "));
            const intersection = new Set([...setA].filter(x => setB.has(x)));
            const union = new Set([...setA, ...setB]);
            return intersection.size / union.size;
        }

        function findBestMatch(question, threshold = 0.5) {
            let bestMatchAnswer = qaDataset[0].Answer; // Default answer if no match
            let bestMatchQuestion = qaDataset[0].Question; // Similar question if no answer meets threshold
            let highestScore = 0;
        
            qaDataset.forEach(entry => {
                const score = jaccardSimilarity(question, entry.Question);
                if (score > highestScore) {
                    highestScore = score;
                    bestMatchAnswer = entry.Answer;
                    bestMatchQuestion = entry.Question;
                }
            });
        
            // Return best match answer if it meets the threshold; otherwise, return the similar question
            if (highestScore >= threshold) {
                return bestMatchAnswer;
            } else {
                return `${qaDataset[0].Answer}, apakah maksud kamu: "${bestMatchQuestion}"?`;
            }
        }


        function addMessageToChatbox(message, sender) {
            const messageElement = `<div><strong>${sender}:</strong> ${message}</div>`;
            $("#chatbox").append(messageElement);
            $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
        }

        $(document).ready(function() {
            loadData();

            $("#sendButton").click(function() {
                const userQuestion = $("#userInput").val().trim();
                if (userQuestion === "") return;

                addMessageToChatbox(userQuestion, "User");

                const botAnswer = findBestMatch(userQuestion);
                addMessageToChatbox(botAnswer, "Bot");

                $("#userInput").val("");
            });

            $("#userInput").on("keypress", function(event) {
                if (event.key === "Enter") {
                    $("#sendButton").click();
                }
            });
        });
    </script>
</body>
</html>
