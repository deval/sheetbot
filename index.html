<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Chatbot</h2>
        <div id="chatbox" class="border rounded p-3 mb-3" style="height: 400px; overflow-y: auto;"></div>
        <div class="input-group">
            <input type="text" id="userInput" class="form-control" placeholder="Type your question here...">
            <button id="sendButton" class="btn btn-primary">Send</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.3/tabletop.min.js"></script>

    <script>
        const sheetID = 'YOUR_GOOGLE_SHEET_ID'; // Replace with your Google Sheet ID
        let qaDataset = [];

        function loadData() {
            Tabletop.init({
                key: sheetID,
                simpleSheet: true,
                callback: function(data) {
                    qaDataset = data;
                    console.log("Data loaded:", qaDataset);
                }
            });
        }

        function jaccardSimilarity(a, b) {
            const setA = new Set(a.toLowerCase().split(" "));
            const setB = new Set(b.toLowerCase().split(" "));
            const intersection = new Set([...setA].filter(x => setB.has(x)));
            const union = new Set([...setA, ...setB]);
            return intersection.size / union.size;
        }

        function findBestMatch(question) {
            let bestMatch = qaDataset[0].Answer;
            let highestScore = 0;

            qaDataset.forEach(entry => {
                const score = jaccardSimilarity(question, entry.Question);
                if (score > highestScore) {
                    highestScore = score;
                    bestMatch = entry.Answer;
                }
            });

            return bestMatch;
        }

        function addMessageToChatbox(message, sender) {
            const messageElement = `<div><strong>${sender}:</strong> ${message}</div>`;
            $("#chatbox").append(messageElement);
            $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
        }

        $(document).ready(function() {
            loadData();

            $("#sendButton").click(function() {
                const userQuestion = $("#userInput").val().trim();
                if (userQuestion === "") return;

                addMessageToChatbox(userQuestion, "User");

                const botAnswer = findBestMatch(userQuestion);
                addMessageToChatbox(botAnswer, "Bot");

                $("#userInput").val("");
            });

            $("#userInput").on("keypress", function(event) {
                if (event.key === "Enter") {
                    $("#sendButton").click();
                }
            });
        });
    </script>
</body>
</html>
